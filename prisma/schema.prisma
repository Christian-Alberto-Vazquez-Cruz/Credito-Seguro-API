generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model ConsentimientoConsulta {
  id                                                           Int                   @id(map: "PK__Consenti__3213E83F78647904") @default(autoincrement())
  idEntidadTitular                                             Int
  idEntidadConsultante                                         Int
  fechaConsentimiento                                          DateTime?
  fechaInicio                                                  DateTime              @db.Date
  fechaVencimiento                                             DateTime              @db.Date
  revocado                                                     Boolean?
  fechaRevocacion                                              DateTime?
  ipOrigen                                                     String?               @db.NVarChar(45)
  numeroConsultasRealizadas                                    Int?
  fechaUltimaConsulta                                          DateTime?
  Entidad_ConsentimientoConsulta_idEntidadTitularToEntidad     Entidad               @relation("ConsentimientoConsulta_idEntidadTitularToEntidad", fields: [idEntidadTitular], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_ConsentimientoConsulta_Usuario")
  Entidad_ConsentimientoConsulta_idEntidadConsultanteToEntidad Entidad               @relation("ConsentimientoConsulta_idEntidadConsultanteToEntidad", fields: [idEntidadConsultante], references: [id], onUpdate: NoAction, map: "FK_ConsentimientoConsulta_UsuarioEntidad")
  LogConsultaTerceros                                          LogConsultaTerceros[]
}

model ConsentimientoEntidad {
  id               Int       @id(map: "PK__Consenti__3213E83FA7B47E85") @default(autoincrement())
  idEntidad        Int
  fechaInicio      DateTime  @db.Date
  fechaVencimiento DateTime  @db.Date
  revocado         Boolean?
  fechaRevocacion  DateTime?
  Entidad          Entidad   @relation(fields: [idEntidad], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Consentimiento_Entidad")
}

model ConsumoEntidad {
  idEntidad           Int
  periodoInicio       DateTime @db.Date
  consultasRealizadas Int
  ultimaActualizacion DateTime
  Entidad             Entidad  @relation(fields: [idEntidad], references: [id], onUpdate: NoAction, map: "FK_ConsumoEntidad_Entidad")

  @@id([idEntidad, periodoInicio], map: "PK_ConsumoEntidad")
}

model Entidad {
  id                                                                          Int                      @id(map: "PK__Entidad__3213E83F894048E6") @default(autoincrement())
  idPlan                                                                      Int
  tipoEntidad                                                                 String                   @db.NVarChar(10)
  nombreLegal                                                                 String                   @db.NVarChar(200)
  rfc                                                                         String                   @unique(map: "UQ__Entidad__C2B0349401F62DDA") @db.NVarChar(13)
  fechaAlta                                                                   DateTime?
  activo                                                                      Boolean?
  ConsentimientoConsulta_ConsentimientoConsulta_idEntidadTitularToEntidad     ConsentimientoConsulta[] @relation("ConsentimientoConsulta_idEntidadTitularToEntidad")
  ConsentimientoConsulta_ConsentimientoConsulta_idEntidadConsultanteToEntidad ConsentimientoConsulta[] @relation("ConsentimientoConsulta_idEntidadConsultanteToEntidad")
  ConsentimientoEntidad                                                       ConsentimientoEntidad[]
  ConsumoEntidad                                                              ConsumoEntidad[]
  PlanSuscripcion                                                             PlanSuscripcion          @relation(fields: [idPlan], references: [id], onUpdate: NoAction, map: "FK_Entidad_IdPlan")
  HistorialScore                                                              HistorialScore[]
  LogConsultaTerceros                                                         LogConsultaTerceros[]
  Reclamacion                                                                 Reclamacion[]
  Usuario                                                                     Usuario[]
}

model HistorialScore {
  id                Int           @id(map: "PK__Historia__3213E83FA1B2466F") @default(autoincrement())
  idEntidad         Int
  puntajeScore      Int
  nivelRiesgo       String        @db.NVarChar(20)
  factoresPositivos String?       @db.NVarChar(Max)
  factoresNegativos String?       @db.NVarChar(Max)
  fechaCalculo      DateTime?
  Entidad           Entidad       @relation(fields: [idEntidad], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_HistorialScore_Entidad")
  Reclamacion       Reclamacion[]
}

model LogConsultaTerceros {
  id                     Int                     @id(map: "PK__LogConsu__3213E83FD8C2CFB1") @default(autoincrement())
  idConsentimiento       Int?
  idEntidadTitular       Int
  idEntidadConsultante   Int
  idUsuarioOperador      Int
  entidadConsultante     String                  @db.NVarChar(200)
  tipoConsulta           String                  @db.NVarChar(50)
  fechaConsulta          DateTime?
  resultadoConsulta      String                  @db.NVarChar(30)
  ipOrigen               String?                 @db.NVarChar(45)
  ConsentimientoConsulta ConsentimientoConsulta? @relation(fields: [idConsentimiento], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_LogConsulta_Consentimiento")
  Entidad                Entidad                 @relation(fields: [idEntidadTitular], references: [id], onUpdate: NoAction, map: "FK_LogConsulta_Usuario")
  Usuario                Usuario                 @relation(fields: [idUsuarioOperador], references: [id], onUpdate: NoAction, map: "FK_LogConsulta_UsuarioOperador")
}

model Notificacion {
  id               Int       @id(map: "PK__Notifica__3213E83FEAA07814") @default(autoincrement())
  tipoNotificacion String    @db.NVarChar(50)
  idUsuario        Int
  titulo           String    @db.NVarChar(200)
  mensaje          String    @db.NVarChar(Max)
  hora             DateTime?
  visto            Boolean?
  Usuario          Usuario   @relation(fields: [idUsuario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Notificacion_Usuario")
}

model PlanSuscripcion {
  id                    Int       @id(map: "PK__PlanSusc__3213E83F03068E02") @default(autoincrement())
  tipoPlan              String    @unique(map: "UQ__PlanSusc__A7343DADF4536384") @db.NVarChar(30)
  maxConsultasMensuales Int
  Entidad               Entidad[]
}

model Recomendacion {
  id                Int       @id(map: "PK__Recomend__3213E83F1D87B6D2") @default(autoincrement())
  idUsuario         Int
  tipoRecomendacion String    @db.NVarChar(50)
  titulo            String    @db.NVarChar(200)
  descripcion       String    @db.NVarChar(Max)
  impactoEstimado   String?   @db.NVarChar(20)
  prioridad         Int?
  estado            String?   @db.NVarChar(30)
  fechaCreacion     DateTime?
  Usuario           Usuario   @relation(fields: [idUsuario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Recomendacion_Usuario")
}

model RefreshToken {
  id             Int       @id(map: "PK__RefreshT__3213E83F6A5E60EE") @default(autoincrement())
  idUsuario      Int
  tokenHash      String    @unique(map: "UQ__RefreshT__9015C60E10D51CB0") @db.NVarChar(64)
  horaCreacion   DateTime?
  horaExpiracion DateTime
  revocado       Boolean?
  ipOrigen       String?   @db.NVarChar(45)
  Usuario        Usuario   @relation(fields: [idUsuario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_RefreshToken_Usuario")
}

model Rol {
  id        Int       @id(map: "PK__Rol__3213E83F4ED8870F") @default(autoincrement())
  nombreRol String    @unique(map: "UQ__Rol__2787B00C165B432A") @db.NVarChar(30)
  Usuario   Usuario[]
}

model Usuario {
  id                    Int                   @id(map: "PK__Usuario__3213E83F0BF4AB73") @default(autoincrement())
  idEntidad             Int
  idRol                 Int
  nombre                String                @db.NVarChar(100)
  correo                String                @unique(map: "UQ__Usuario__2A586E0B474942D7") @db.NVarChar(255)
  contraseniaHash       String                @db.VarChar(255)
  fechaCreacion         DateTime?
  activo                Boolean?
  notificacionesActivas Boolean?
  LogConsultaTerceros   LogConsultaTerceros[]
  Notificacion          Notificacion[]
  Reclamacion           Reclamacion[]
  Recomendacion         Recomendacion[]
  RefreshToken          RefreshToken[]
  Entidad               Entidad               @relation(fields: [idEntidad], references: [id], onUpdate: NoAction, map: "FK_Usuario_Entidad")
  Rol                   Rol                   @relation(fields: [idRol], references: [id], onUpdate: NoAction, map: "FK_Usuario_Rol")
}

model Reclamacion {
  id               Int             @id(map: "PK__Reclamac__3213E83F32BFE433") @default(autoincrement())
  folio            String          @unique(map: "UQ__Reclamac__E8F12C9F0CBBF504") @db.NVarChar(20)
  idUsuario        Int
  idEntidad        Int
  idHistorialScore Int?
  evidenciaUrl     String?         @db.NVarChar(500)
  motivo           String          @db.NVarChar(Max)
  estado           String          @db.NVarChar(30)
  respuestaAdmin   String?         @db.NVarChar(Max)
  fechaCreacion    DateTime
  fechaResolucion  DateTime?
  Entidad          Entidad         @relation(fields: [idEntidad], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Reclamacion_Entidad")
  HistorialScore   HistorialScore? @relation(fields: [idHistorialScore], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "FK_Reclamacion_Historial")
  Usuario          Usuario         @relation(fields: [idUsuario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Reclamacion_Usuario")
}
